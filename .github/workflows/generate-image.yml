name: Generate Image

on:
  schedule:
      - cron: "0 */1 * * *" # every 1 hours
  workflow_dispatch:

jobs:
  make-image:
      runs-on: ubuntu-latest
      steps:
        - name: Checkout code
          uses: actions/checkout@v3
  
        - name: Set up Node.js
          uses: actions/setup-node@v3
          with:
            node-version: '16.x'
      
        - name: Install NPM Dependencies
          run: npm install
        
        - name: Generate Image
          run: node generate-image.js
    
        - name: Checkout to image-output branch
          run: git checkout -B image-output
          
        - name: Commit and Push
          run: |
            git config user.name 'shankarlohar'
            git config user.email 'shankarloharmail@gmail.com'
            git add -A
            git commit -m "Generate new image"
            git push origin image-output --force
          env:
            GITHUB_TOKEN: ${{ secrets.CODEFORCES_TOKEN }}
